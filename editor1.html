<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>FotoÄŸraf DÃ¼zenleyici - Ã‡alÄ±ÅŸan SÃ¼rÃ¼m</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: sans-serif;
  background: #f0f0f0;
  text-align: center;
  margin: 0; padding: 0;
}
#toolbar {
  background: #333; color: white;
  padding: 10px; display: flex;
  flex-wrap: wrap; justify-content: center; gap: 8px;
}
button, input[type="color"], input[type="range"] {
  cursor: pointer; border: none;
  border-radius: 6px;
  padding: 6px 10px;
}
canvas {
  border: 2px solid #333;
  margin-top: 10px;
  background: white;
}
#loading { color:#333; font-size:14px; margin-top:8px; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
</head>
<body>

<div id="toolbar">
  <label><b>Katman 1:</b> <input type="file" id="file1" accept="image/*"></label>
  <label><b>Katman 2:</b> <input type="file" id="file2" accept="image/*"></label>
  <button id="addText">Metin Ekle</button>
  <input type="color" id="textColor" value="#000000">
  <input type="range" id="opacity" min="0" max="1" step="0.05" value="1" title="SaydamlÄ±k">
  <button id="save">ðŸ’¾ Kaydet</button>
</div>

<div id="loading"></div>
<canvas id="canvas" width="800" height="600"></canvas>

<script>
const canvas = new fabric.Canvas('canvas', { backgroundColor: '#fff' });
const loading = document.getElementById('loading');

function addImageSequential(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  loading.textContent = "ðŸ“¸ GÃ¶rsel yÃ¼kleniyor...";
  reader.onload = (ev) => {
    const data = ev.target.result;
    fabric.util.loadImage(data, function(imgEl) {
      const img = new fabric.Image(imgEl, { objectCaching: false });
      const scale = Math.min(canvas.width / img.width, canvas.height / img.height) * 0.9;
      img.scale(scale);
      img.set({
        left: (canvas.width - img.width * scale) / 2,
        top: (canvas.height - img.height * scale) / 2
      });
      canvas.add(img);
      canvas.setActiveObject(img);
      canvas.renderAll();
      loading.textContent = "";
      console.log("âœ… GÃ¶rsel eklendi:", img.width, img.height);
    }, { crossOrigin: 'anonymous' });
  };
  reader.readAsDataURL(file);
}

document.getElementById('file1').onchange = function() { addImageSequential(this); };
document.getElementById('file2').onchange = function() { addImageSequential(this); };

// Metin ekleme
document.getElementById('addText').onclick = () => {
  const t = new fabric.IText('Metin', {
    left: 300, top: 250, fill: document.getElementById('textColor').value, fontSize: 40
  });
  canvas.add(t);
  canvas.setActiveObject(t);
};

// Renk deÄŸiÅŸimi
document.getElementById('textColor').onchange = (e) => {
  const obj = canvas.getActiveObject();
  if (obj && obj.type === 'i-text') {
    obj.set('fill', e.target.value);
    canvas.renderAll();
  }
};

// SaydamlÄ±k
document.getElementById('opacity').oninput = (e) => {
  const obj = canvas.getActiveObject();
  if (obj) {
    obj.set('opacity', parseFloat(e.target.value));
    canvas.renderAll();
  }
};

// Kaydetme
document.getElementById('save').onclick = () => {
  const link = document.createElement('a');
  link.download = 'duzenlenmis.png';
  link.href = canvas.toDataURL({ format: 'png' });
  link.click();
};
</script>

</body>
</html>